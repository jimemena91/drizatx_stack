# ğŸ–¨ï¸ DrizaTx â€” ImpresiÃ³n silenciosa en modo kiosco (Windows + Chrome)

Este documento explica, paso a paso, cÃ³mo configurar la **Terminal de Autoservicio** de DrizaTx para **imprimir tickets sin mostrar la vista previa** del navegador usando **Google Chrome en modo kiosco**.  
La guÃ­a estÃ¡ pensada para ejecutarla **una Ãºnica vez en la PC del cliente** y que luego sea **mantenible con el tiempo**.

---

## âš¡ï¸ Resumen (si ya sabÃ©s quÃ© hacÃ©s)

1. DejÃ¡ la **impresora correcta como predeterminada** en Windows.  
2. Asegurate de tener el **CSS de impresiÃ³n** de ticket (ver secciÃ³n [CSS de impresiÃ³n](#-css-de-impresiÃ³n)).  
3. ActivÃ¡ `kioskPrintingEnabled = true` (desde settings del backend o con `localStorage`).  
4. CreÃ¡ un **acceso directo de Chrome** con flags:  
   `--kiosk --kiosk-printing --disable-print-preview --no-first-run --no-default-browser-check --incognito`  
   apuntando a `/terminal`.  
5. (Opcional) CopiÃ¡ el acceso directo a **Inicio de Windows** para autoarranque.

---

## ğŸ“‹ Requisitos

- **Windows 10 u 11**
- **Google Chrome** (v110+)
- **Impresora** conectada y reconocida por el sistema (tÃ©rmica 80 mm o estÃ¡ndar)
- **URL** de la Terminal DrizaTx (p. ej. ambiente de desarrollo en Vercel):

https://drizatx-main.vercel.app/terminal


> Chrome en kiosco **siempre imprime en la impresora predeterminada** del sistema.  
> Configurala antes de continuar.

---

## ğŸ§± Paso 1 â€” Impresora predeterminada

1. AbrÃ­ **Panel de control â†’ Dispositivos e impresoras**.
2. Clic derecho sobre la impresora deseada â†’ **Establecer como predeterminada**.
3. RevisÃ¡ **Preferencias de impresiÃ³n**:
 - TamaÃ±o: `80mm x rollo continuo` (si es tÃ©rmica) o el que corresponda.
 - MÃ¡rgenes: **mÃ­nimos o 0**.
 - OrientaciÃ³n: **vertical**.

---

## ğŸ¨ CSS de impresiÃ³n

Asegurate de tener estas reglas (en `globals.css` o una hoja cargada globalmente):

```css
/* Solo se imprime el contenido marcado como ticket y se oculta el resto */
@media print {
[data-print-hidden="true"] {
  display: none !important;
}

[data-print-only="true"],
.terminal-print-ticket {
  display: block !important;
  visibility: visible !important;
}

@page {
  size: 80mm auto; /* ancho 80mm, alto dinÃ¡mico */
  margin: 5mm;
}

.terminal-print-ticket {
  width: 80mm;
}
}

Esto asegura que en modo kiosco solo salga el ticket, no toda la UI.

ğŸ§  Paso 2 â€” Activar impresiÃ³n kiosco en la UI

La Terminal usa una bandera kioskPrintingEnabled para decidir si llama window.print() en automÃ¡tico al generar el ticket.

TenÃ©s dos formas de activarla:

OpciÃ³n A: Desde el backend (recomendada)

En System Settings (NestJS), setear:

kioskPrintingEnabled = true


Key tÃ­pica: terminal.kioskPrintingEnabled o la que uses en tu useSystemSettings.

OpciÃ³n B: Local (rÃ¡pida)

AbrÃ­ la consola del navegador en la Terminal (F12 â†’ Console) y ejecutÃ¡:

localStorage.setItem("kioskPrintingEnabled", "true");


Esta opciÃ³n persiste en el browser local y no afecta a otros equipos.

ğŸ§­ Paso 3 â€” Crear acceso directo de Chrome (modo kiosco)
ğŸ”¹ Script PowerShell (automÃ¡tico)

CopiÃ¡ y pegÃ¡ en PowerShell (no en CMD). Si Chrome estÃ¡ abierto, lo cierra y crea un acceso directo en el escritorio.

# === Configurable ===
$TerminalUrl = "https://drizatx-main.vercel.app/terminal"
$ShortcutName = "DrizaTx Terminal.lnk"

# 1) Detectar Chrome
$chrome = "C:\Program Files\Google\Chrome\Application\chrome.exe"
if (-not (Test-Path $chrome)) {
  $chrome = "C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"
}
if (-not (Test-Path $chrome)) {
  Write-Error "No se encontrÃ³ Chrome en las rutas estÃ¡ndar."
  exit 1
}

# 2) Cerrar Chrome si estÃ¡ abierto (para evitar que ignore flags)
Get-Process chrome -ErrorAction SilentlyContinue | Stop-Process -Force

# 3) Flags de kiosco
$arguments = @(
  "--kiosk", "`"$TerminalUrl`""
  "--kiosk-printing"
  "--disable-print-preview"
  "--no-first-run"
  "--no-default-browser-check"
  "--incognito"
) -join " "

# 4) Crear acceso directo
$WshShell = New-Object -ComObject WScript.Shell
$shortcutPath = Join-Path $env:Public\Desktop $ShortcutName
$Shortcut = $WshShell.CreateShortcut($shortcutPath)
$Shortcut.TargetPath = $chrome
$Shortcut.Arguments = $arguments
$Shortcut.IconLocation = "$chrome,0"
$Shortcut.WorkingDirectory = Split-Path $chrome
$Shortcut.Save()

Write-Host "âœ… Atajo creado en: $shortcutPath"
Write-Host "Para autoarranque, ejecutar: shell:startup y copiar el acceso directo."

ğŸ”¹ Alternativa: archivo .bat

GuardÃ¡ como drizatx-kiosk.bat (clic derecho â†’ Ejecutar como administrador):

@echo off
set "URL=https://drizatx-main-git-develop-jimemena91s-projects.vercel.app/terminal"
set "CHROME=C:\Program Files\Google\Chrome\Application\chrome.exe"
if not exist "%CHROME%" set "CHROME=C:\Program Files (x86)\Google\Chrome\Application\chrome.exe"
if not exist "%CHROME%" (
  echo No se encontro Chrome. Editar ruta en este BAT.
  pause
  exit /b 1
)

taskkill /IM chrome.exe /F >nul 2>nul

start "" "%CHROME%" --kiosk "%URL%" --kiosk-printing --disable-print-preview --no-first-run --no-default-browser-check --incognito


PodÃ©s arrastrar este BAT a shell:startup para autoarranque.

ğŸ§ª Paso 4 â€” Prueba funcional

AbrÃ­ la Terminal con el acceso directo (o corriendo el BAT).

GenerÃ¡ un ticket â†’ la UI harÃ¡ window.print() y no debe verse la vista previa.

Debe imprimirse en la impresora predeterminada y con el formato CSS definido.

ğŸ§° Troubleshooting
Problema	Causa frecuente	CÃ³mo se arregla
Se abre la vista previa	Chrome ya estaba abierto sin flags	CerrÃ¡ todas las ventanas de Chrome y reabrÃ­ desde el acceso directo con flags
Imprime en otra impresora	Predeterminada mal configurada	CambiÃ¡ la predeterminada en Dispositivos e impresoras
No imprime	Driver, cable o permisos	ReinstalÃ¡ driver, verificÃ¡ cable/red, probÃ¡ desde Notepad
Ticket sale cortado	TamaÃ±o de papel o mÃ¡rgenes	AjustÃ¡ tamaÃ±o 80 mm y @page{ margin:5mm }
Aparece Unable to decode audio data	Sonido del browser	Es inofensivo; ignorar
Vercel muestra CORS	Front configurado para prod	Para kiosco puro no dependÃ©s de APIs externas; si usÃ¡s backend, habilitÃ¡ CORS o usa tu dominio final
ğŸ§¼ Mantenimiento recomendado

Usuario exclusivo de Windows para el kiosco (sin notificaciones ni apps extra).

Desactivar suspensiÃ³n, bloqueo y ahorro de energÃ­a.

Mantener drivers y Chrome actualizados.

Evitar extensiones y uso personal del navegador.

Revisar periÃ³dicamente el papel y el estado de la impresora.

â“FAQ

Â¿QuÃ© pasa si el usuario pulsa ESC o Alt+F4?
Puede salir del modo kiosco. Recomendamos ocultar teclado o supervisar.

Â¿Se puede elegir impresora en tiempo de ejecuciÃ³n?
No en kiosco puro. Chrome usa siempre la predeterminada del sistema.

Â¿Puedo ocultar por completo la UI y dejar solo ticket?
SÃ­: usÃ¡ el bloque .terminal-print-ticket como â€œplantillaâ€ de ticket y marcÃ¡ el resto con data-print-hidden="true".

Â¿CÃ³mo vuelvo a la pantalla inicial tras imprimir?
Tu TerminalPage ya programa un redirect. AjustÃ¡ el timeout si lo necesitÃ¡s (por ejemplo, 3â€“5 s).

ğŸ§© Referencias tÃ©cnicas del proyecto

Frontend: Next.js + TailwindCSS

Pantalla: app/terminal/page.tsx (usa window.print() cuando kioskPrintingEnabled = true)

CSS de impresiÃ³n: global styles (globals.css)

Backend (opcional): NestJS System Settings (terminal.kioskPrintingEnabled)

ğŸ‘©â€ğŸ’» Contacto

Driza Software â€” DrizaTx
ImplementaciÃ³n y soporte: Equipo Driza
Ãšltima actualizaciÃ³n: Octubre 2025


---

Â¿QuerÃ©s que te agregue tambiÃ©n un **.bat** que cree el acceso directo automÃ¡ticamente (sin PowerShell) y otro script para **copiarlo al inicio** del sistema? Te los armo al toque.
